<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Battle</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Entry Screen -->
    <div id="entry-screen" class="screen">
        <div class="title-container">
            <h1 class="game-title">Cosmic Battle</h1>
            <p class="game-subtitle">Turn-Based Strategy</p>
        </div>
        <div class="menu-options">
            <button class="menu-btn" onclick="game.showSpiritSelection('single')">Âçï‰∫∫Ê®°Âºè</button>
            <button class="menu-btn" onclick="game.showSpiritSelection('multi')">Âèå‰∫∫ÂØπÊàò</button>
        </div>
    </div>

    <!-- Spirit Selection Screen -->
    <div id="selection-screen" class="screen hidden">
        <h2 class="screen-title">ÈÄâÊã©‰Ω†ÁöÑÁ≤æÁÅµ</h2>
        <div class="selection-container">
            <div class="team-preview" id="p1-preview">
                <h3>Áé©ÂÆ∂ 1</h3>
                <div class="preview-slots" id="p1-slots"></div>
            </div>

            <div class="spirit-pool-container">
                <div class="spirit-pool" id="spirit-pool">
                    <!-- Spirits injected here -->
                </div>
            </div>

            <div class="team-preview" id="p2-preview">
                <h3 id="p2-title">ÁîµËÑë / Áé©ÂÆ∂ 2</h3>
                <div class="preview-slots" id="p2-slots"></div>
            </div>
        </div>
        <div class="selection-controls">
            <button class="control-btn secondary" onclick="game.showEntryScreen()">ËøîÂõû</button>
            <button class="control-btn primary" id="start-battle-btn" onclick="game.startGame()" disabled>ÂºÄÂßãÊàòÊñó</button>
        </div>
    </div>

    <div class="game-container hidden" id="game-container">
        <!-- Tooltip -->
        <div id="tooltip" class="tooltip hidden"></div>

        <!-- Top HUD -->
        <div class="hud">
            <div class="player-status">
                <div class="avatar-frame">
                    <img src="assets/king_gaia.png" alt="Player" class="avatar">
                    <!-- Soul Mark Icon -->
                    <div class="soul-mark" id="soul-mark" onmouseenter="game.showTooltip(event, 'soul-mark')"
                        onmouseleave="game.hideTooltip()">
                        È≠Ç
                    </div>
                </div>
                <div class="bars">
                    <div class="name-tag">Áéã¬∑Áõñ‰∫ö</div>
                    <div class="pokemon-count" id="player-pokemon-count"></div>
                    <div class="hp-bar-container">
                        <div class="hp-bar" id="player-hp-bar" style="width: 100%;"></div>
                        <span class="hp-text" id="player-hp-text">576/576</span>
                    </div>
                    <div class="status-container">
                        <div class="control-row" id="player-control-row"></div>
                        <div class="buff-row" id="player-buff-row"></div>
                        <div class="stat-row" id="player-stat-row"></div>
                    </div>
                </div>
            </div>

            <div class="vs-badge">VS</div>

            <div class="enemy-status">
                <div class="bars">
                    <div class="name-tag">ÂØπÊâã</div>
                    <div class="pokemon-count" id="enemy-pokemon-count"></div>
                    <div class="hp-bar-container">
                        <div class="hp-bar enemy" id="enemy-hp-bar" style="width: 100%;"></div>
                        <span class="hp-text" id="enemy-hp-text">800/800</span>
                    </div>
                    <div class="status-container">
                        <div class="control-row" id="enemy-control-row"></div>
                        <div class="buff-row" id="enemy-buff-row"></div>
                        <div class="stat-row" id="enemy-stat-row"></div>
                    </div>
                </div>
                <div class="avatar-frame enemy">
                    <img src="" alt="Enemy" class="avatar" id="enemy-avatar" style="display: none;">
                    <div class="avatar-placeholder"></div>
                    <!-- Enemy Soul Mark Icon -->
                    <div class="soul-mark" id="enemy-soul-mark"
                        onmouseenter="game.showTooltip(event, 'enemy-soul-mark')" onmouseleave="game.hideTooltip()">
                        È≠Ç
                    </div>
                </div>
            </div>
        </div>

        <!-- Battle Scene -->
        <div class="battle-scene">
            <div class="character-container player">
                <img src="assets/king_gaia.png" alt="Player Character" class="character-sprite" id="player-sprite">
                <div class="effect-overlay" id="player-effect"></div>
            </div>
            <div class="character-container enemy">
                <div class="enemy-sprite" id="enemy-sprite"></div>
                <div class="effect-overlay" id="enemy-effect"></div>
            </div>

            <!-- Damage Numbers Overlay -->
            <div class="damage-overlay" id="damage-overlay"></div>

            <!-- Bag Modal -->
            <div id="bag-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>ËÉåÂåÖ</h3>
                    <div class="item-list">
                        <button class="item-btn" onclick="game.useItem('pp_potion')">
                            <span class="item-name">PPÂõûÂ§çËçØÂâÇ</span>
                            <span class="item-desc">ÊÅ¢Â§çÊâÄÊúâÊäÄËÉΩ 10 PP</span>
                            <span class="item-count" id="item-count-pp">x5</span>
                        </button>
                        <button class="item-btn" onclick="game.useItem('hp_potion')">
                            <span class="item-name">È´òÁ∫ßÊ≤ªÁñóËçØÂâÇ</span>
                            <span class="item-desc">ÊÅ¢Â§ç350‰ΩìÂäõ</span>
                            <span class="item-count" id="item-count-hp">x3</span>
                        </button>
                    </div>
                    <button class="close-btn" onclick="game.toggleBag()">ÂÖ≥Èó≠</button>
                </div>
            </div>

            <!-- Switch Modal -->
            <div id="switch-modal" class="modal hidden">
                <div class="modal-content">
                    <h3>Êõ¥Êç¢Á≤æÁÅµ</h3>
                    <div class="item-list" id="team-list">
                        <!-- Team members injected here -->
                    </div>
                    <button class="close-btn" onclick="game.toggleSwitch()">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>

        <!-- Bottom Panel -->
        <div class="bottom-panel">
            <!-- Skills -->
            <div class="skills-left-container">
                <!-- Ultimate Skill -->
                <button class="skill-btn ult" onclick="game.useSkill(4)" onmouseenter="game.showTooltip(event, 4)"
                    onmouseleave="game.hideTooltip()">
                    <div class="skill-icon">üëë</div>
                    <div class="skill-info">
                        <span class="skill-name" id="skill-name-4">Áéã¬∑Âú£ÂãáÊàòÊÑè</span>
                        <span class="skill-power" id="skill-power-4">Â®ÅÂäõ: 160</span>
                        <span class="skill-pp" id="pp-4">PP: 5/5</span>
                    </div>
                </button>
            </div>

            <div class="skills-grid-container">
                <button class="skill-btn" onclick="game.useSkill(0)" onmouseenter="game.showTooltip(event, 0)"
                    onmouseleave="game.hideTooltip()">
                    <div class="skill-icon" id="skill-icon-0">üõ°Ô∏è</div>
                    <div class="skill-info">
                        <span class="skill-name" id="skill-name-0">ÊàòÈú∏Â§©‰∏ã</span>
                        <span class="skill-power" id="skill-power-0">Â®ÅÂäõ: 0</span>
                        <span class="skill-pp" id="pp-0">PP: 5/5</span>
                    </div>
                </button>
                <button class="skill-btn" onclick="game.useSkill(1)" onmouseenter="game.showTooltip(event, 1)"
                    onmouseleave="game.hideTooltip()">
                    <div class="skill-icon" id="skill-icon-1">‚ú®</div>
                    <div class="skill-info">
                        <span class="skill-name" id="skill-name-1">‰∏çË¥•‰πãÂ¢É</span>
                        <span class="skill-power" id="skill-power-1">Â®ÅÂäõ: 0</span>
                        <span class="skill-pp" id="pp-1">PP: 5/5</span>
                    </div>
                </button>
                <button class="skill-btn" onclick="game.useSkill(2)" onmouseenter="game.showTooltip(event, 2)"
                    onmouseleave="game.hideTooltip()">
                    <div class="skill-icon" id="skill-icon-2">‚öîÔ∏è</div>
                    <div class="skill-info">
                        <span class="skill-name" id="skill-name-2">Â§©ËØõ‰π±Ëàû</span>
                        <span class="skill-power" id="skill-power-2">Â®ÅÂäõ: 130</span>
                        <span class="skill-pp" id="pp-2">PP: 10/10</span>
                    </div>
                </button>
                <button class="skill-btn" onclick="game.useSkill(3)" onmouseenter="game.showTooltip(event, 3)"
                    onmouseleave="game.hideTooltip()">
                    <div class="skill-icon" id="skill-icon-3">‚ö°</div>
                    <div class="skill-info">
                        <span class="skill-name" id="skill-name-3">Â§©Â®ÅÂäõÁ†¥</span>
                        <span class="skill-power" id="skill-power-3">Â®ÅÂäõ: 85</span>
                        <span class="skill-pp" id="pp-3">PP: 20/20</span>
                    </div>
                </button>
            </div>

            <!-- Battle Log & Actions -->
            <div class="right-panel-group">
                <div class="battle-log-container">
                    <div class="battle-log" id="battle-log">
                        <div class="log-entry">ÊàòÊñóÂºÄÂßã!</div>
                    </div>
                </div>
                <div class="actions-panel">
                    <button class="action-btn" id="btn-bag" onclick="game.toggleBag()">ËÉåÂåÖ</button>
                    <button class="action-btn" id="btn-switch" onclick="game.toggleSwitch()">Á≤æÁÅµ</button>
                    <button class="action-btn" id="btn-catch">ÊçïÊçâ</button>
                    <button class="action-btn" id="btn-run">ÈÄÉË∑ë</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ============================================================ -->
    <!-- Core Systems v2.1 (Load Order Matters) -->
    <!-- ============================================================ -->
    
    <!-- 1. Turn Phase System (36 Nodes) -->
    <script src="core/turn_phase.js"></script>
    
    <!-- 2. State Containers -->
    <script src="core/spirit_state.js"></script>
    <script src="core/team_state.js"></script>
    <script src="core/global_state.js"></script>
    <script src="core/player_input.js"></script>
    
    <!-- 3. Core Systems (SYSTEM.SUBFUNC format) -->
    <script src="core/turn_effect.js"></script>
    <script src="core/count_effect.js"></script>
    <script src="core/damage.js"></script>
    <script src="core/hp.js"></script>
    <script src="core/pp.js"></script>
    <script src="core/stats.js"></script>
    <script src="core/status.js"></script>
    <script src="core/priority.js"></script>
    <script src="core/soulbuff.js"></script>
    
    <!-- 4. Team Instances -->
    <script src="core/team.js"></script>
    <script src="core/team_a.js"></script>
    <script src="core/team_b.js"></script>
    
    <!-- 5. Integration -->
    <script src="core/systems.js"></script>
    <script src="core/battle_engine.js"></script>
    <script src="core/index.js"></script>
    
    <!-- ============================================================ -->
    <!-- Legacy Support (for game.js compatibility) -->
    <!-- ============================================================ -->
    <script src="legacy/damage_system.js"></script>
    <script src="legacy/resist_system.js"></script>
    <script src="legacy/status_registry.js"></script>
    <script src="legacy/turn_phases.js"></script>
    <script src="legacy/turneffect.js"></script>
    <script src="legacy/counteffect.js"></script>
    <script src="legacy/soulbuff.js"></script>
    
    <!-- Fine-grained Effect Modules -->
    <script src="effects/status_effect.js"></script>
    <script src="effects/stat_effect.js"></script>
    <script src="effects/hp_effect.js"></script>
    <script src="effects/shield_effect.js"></script>
    <script src="effects/priority_effect.js"></script>
    <script src="effects/crit_effect.js"></script>
    <script src="effects/immune_effect.js"></script>
    <script src="effects/block_effect.js"></script>
    <script src="effects/effect_router.js"></script>
    <script src="effects/index.js"></script>

    <!-- ============================================================ -->
    <!-- Spirit Registry & Definitions -->
    <!-- ============================================================ -->
    <script src="spirits/registry.js"></script>
    <script src="spirits/king_gaia.js"></script>
    <script src="spirits/agnes.js"></script>
    <script src="spirits/surging_canglan.js"></script>
    <script src="spirits/solensen.js"></script>
    <script src="spirits/star_sovereign.js"></script>
    <script src="spirits/rebirth_wings.js"></script>
    <script src="spirits/incalos.js"></script>
    <script src="spirits/sagross.js"></script>
    <script src="spirits/king_ray.js"></script>
    <script src="spirits/saint_mecha_gaia.js"></script>
    <script src="spirits/aishala.js"></script>

    <!-- ============================================================ -->
    <!-- Game Bridge & Main Game -->
    <!-- ============================================================ -->
    <script src="game_bridge.js"></script>
    <script src="game.js"></script>
</body>

</html>